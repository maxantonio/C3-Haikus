/*! c3haikus 2015-05-21 */
function m_intervalo_Correcto(a,b){var c=datos.columns[0].length-1,d=parseDate(datos.columns[0][1]),e=parseDate(datos.columns[0][c]);return b||(b=e),console.info(a,b),console.info(d,e),a>=d&&e>=b}function m_updateGrafica(a,b){console.log("fecha fin"+b);var c=[a,b];chart.zoom(c),chart2.zoom(c),chart3.internal.brush.extent(c).update(),d3.select("#inicio").attr("value",formatDate(a)),d3.select("#fin").attr("value",formatDate(b))}!function(a){"use strict";function b(a){a=a||{},this.phrases={},this.extend(a.phrases||{}),this.currentLocale=a.locale||"en",this.allowMissing=!!a.allowMissing,this.warn=a.warn||i}function c(a){var b,c,d,e={};for(b in a)if(a.hasOwnProperty(b)){c=a[b];for(d in c)e[c[d]]=b}return e}function d(a){var b=/^\s+|\s+$/g;return a.replace(b,"")}function e(a,b,c){var e,f,h;return null!=c&&a?(f=a.split(k),h=f[g(b,c)]||f[0],e=d(h)):e=a,e}function f(a){var b=c(m);return b[a]||b.en}function g(a,b){return l[f(a)](b)}function h(a,b){for(var c in b)"_"!==c&&b.hasOwnProperty(c)&&(a=a.replace(new RegExp("%\\{"+c+"\\}","g"),b[c]));return a}function i(b){a.console&&a.console.warn&&a.console.warn("WARNING: "+b)}function j(a){var b={};for(var c in a)b[c]=a[c];return b}b.VERSION="0.4.2",b.prototype.locale=function(a){return a&&(this.currentLocale=a),this.currentLocale},b.prototype.extend=function(a,b){var c;for(var d in a)a.hasOwnProperty(d)&&(c=a[d],b&&(d=b+"."+d),"object"==typeof c?this.extend(c,d):this.phrases[d]=c)},b.prototype.clear=function(){this.phrases={}},b.prototype.replace=function(a){this.clear(),this.extend(a)},b.prototype.t=function(a,b){var c,d;return b=null==b?{}:b,"number"==typeof b&&(b={smart_count:b}),"string"==typeof this.phrases[a]?c=this.phrases[a]:"string"==typeof b._?c=b._:this.allowMissing?c=a:(this.warn('Missing translation for key: "'+a+'"'),d=a),"string"==typeof c&&(b=j(b),d=e(c,this.currentLocale,b.smart_count),d=h(d,b)),d};var k="||||",l={chinese:function(a){return 0},german:function(a){return 1!==a?1:0},french:function(a){return a>1?1:0},russian:function(a){return a%10===1&&a%100!==11?0:a%10>=2&&4>=a%10&&(10>a%100||a%100>=20)?1:2},czech:function(a){return 1===a?0:a>=2&&4>=a?1:2},polish:function(a){return 1===a?0:a%10>=2&&4>=a%10&&(10>a%100||a%100>=20)?1:2},icelandic:function(a){return a%10!==1||a%100===11?1:0}},m={chinese:["fa","id","ja","ko","lo","ms","th","tr","zh"],german:["da","de","en","es","fi","el","he","hu","it","nl","no","pt","sv"],french:["fr","tl","pt-br"],russian:["hr","ru"],czech:["cs"],polish:["pl"],icelandic:["is"]};"undefined"!=typeof module&&module.exports?module.exports=b:a.Polyglot=b}(this);var i18n=new Polyglot;i18n.locale(locale),i18n.extend({from:"From",to:"To",select:"Select"}),"es"==i18n.locale()&&i18n.extend({from:"Desde",to:"Hasta",select:"Selecione"});var StockTools=function(a,b){"use strict";function c(){function c(){var a=d3.select(".c3-periodos .selected");if(null!=a[0][0]){var b=a.attr("data-tipo"),c=a.attr("data-value"),d=g(b,c);d3.select("#inicio").attr("value",formatDate(d))}}function f(){var a=d3.select(this).attr("data-value"),b=d3.select(this).attr("data-tipo"),c=datos.columns[0].length-1,e=parseDate(datos.columns[0][c]),f=g(b,a);if(comparando){d3.select("#inicio").attr("value",formatDate(f)),d3.select("#fin").attr("value",formatDate(e));var h=[],i=j(datos.columns[1][0],1,document.getElementById("inicio").value,document.getElementById("fin").value),k=document.getElementsByClassName("c3_cmp")[0].selectedIndex,l=j(d,k+1,document.getElementById("inicio").value,document.getElementById("fin").value);h.push(i),h.push(l);var m=[f,e];chart.zoom(m),chart2.zoom(m),chart3.internal.brush.extent(m).update(),chart.load({columns:h})}else{if(!m_intervalo_Correcto(f,e))throw new Error("No hay datos para este intervalo");m_updateGrafica(f,e)}}function g(a,b){var c=datos.columns[0].length-1,d=parseDate(datos.columns[0][c]),e=new Date(d.getTime());switch(a){case"dia":e.setDate(d.getDate()-b);break;case"mes":e.setMonth(d.getMonth()-b);break;case"anno":e.setYear(d.getFullYear()-b);break;case"hasta_la_fecha":e=new Date(d.getFullYear(),0,1)}return e}function h(){var a=parseDate(document.getElementById("inicio").value),b=parseDate(document.getElementById("fin").value);if(!m_intervalo_Correcto(a,b))throw new Error("No hay datos para este intervalo");m_updateGrafica(a,b)}function i(a){return datos.columns[0].indexOf(a)}function j(a,b,c,d){var e=[a],f=i(c),g=i(d),h=+datos.columns[b][f];return datos.columns[b].forEach(function(a,b){if(b>0)if(b>=f&&g>=b){var c=+a,d=c/h-1;d=+d.toFixed(2),e.push(d)}else e.push(null)}),e}function k(){comparando?chart.load({columns:[datos.columns[1]],unload:[d]}):alert("no estas comparando")}function l(){var a="";""!=d&&(a=d);var b=this.options[this.selectedIndex].value;console.info("Seleccionado: "+b);var c=parseDate(document.getElementById("inicio").value),e=parseDate(document.getElementById("fin").value),f=[];if(!m_intervalo_Correcto(c,e))throw new Error("Intervalo incorrecto");if(0!=this.selectedIndex){comparando=!0,d=b;var g=j(datos.columns[1][0],1,document.getElementById("inicio").value,document.getElementById("fin").value),h=j(b,this.selectedIndex+1,document.getElementById("inicio").value,document.getElementById("fin").value);f.push(g),f.push(h),chart.load(""!=a?{columns:f,unload:[a]}:{columns:f})}else k(c,e),d="",comparando=!1}var m=d3.select(a).append("div").attr("class","c3-header"),n=m.append("div").attr("class","c3-periodos").style("float","left"),o=m.append("div").attr("class","c3-intervalos").style("float","left");o.append("span").text(i18n.t("from")),o.append("input").attr("type","text").style("text-align","center").attr("name","inicio").attr("id","inicio").attr("value",datos.columns[0][1]),o.append("span").text(i18n.t("to")),o.append("input").attr("type","text").style("text-align","center").attr("name","fin").attr("id","fin").attr("value",datos.columns[0][datos.columns[0].length-1]);var p=m.append("div").attr("class","c3-botones").style("float","left");p.append("button").attr("id","update").attr("type","button").text("Actualizar").on("click",h),datos.columns.forEach(function(a,b){b>0&&e.push(datos.columns[b][0])}),e[0]=i18n.t("select");var q=p.append("select").attr("class","c3_cmp");q.selectAll("opciones").data(e).enter().append("option").attr("class","opciones").attr("data-id",function(a){return a}).attr("value",function(a){return a}).text(function(a){return a}),q.on("change",l),m.append("div").attr("class","c3-clear-header").style("clear","both"),n.selectAll("botones").data(b).enter().append("button").attr("type","button").attr("class",function(a){return a.seleccionado?"button selected":"button"}).attr("data-value",function(a){return a.cantidad}).attr("data-tipo",function(a){return a.tipo}).text(function(a){return a.texto}).on("click",f),c()}var d="",e=[];c()};