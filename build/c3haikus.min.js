/*! c3haikus 2015-05-27 */
function m_intervalo_Correcto(a,b){var c=datos.columns[0].length-1,d=parseDate(datos.columns[0][1]),e=parseDate(datos.columns[0][c]);return b||(b=e),a>=d&&e>=b}function m_aux_Update(a,b,c){document.getElementById("inicio").value=formatDate(b),document.getElementById("fin").value=formatDate(c),a.e_update_click()}function m_updateGrafica(a,b){var c=[a,b];chart.zoom(c),chart2.zoom(c),chart3.internal.brush.extent(c).update()}!function(a){"use strict";function b(a){a=a||{},this.phrases={},this.extend(a.phrases||{}),this.currentLocale=a.locale||"en",this.allowMissing=!!a.allowMissing,this.warn=a.warn||i}function c(a){var b,c,d,e={};for(b in a)if(a.hasOwnProperty(b)){c=a[b];for(d in c)e[c[d]]=b}return e}function d(a){var b=/^\s+|\s+$/g;return a.replace(b,"")}function e(a,b,c){var e,f,h;return null!=c&&a?(f=a.split(k),h=f[g(b,c)]||f[0],e=d(h)):e=a,e}function f(a){var b=c(m);return b[a]||b.en}function g(a,b){return l[f(a)](b)}function h(a,b){for(var c in b)"_"!==c&&b.hasOwnProperty(c)&&(a=a.replace(new RegExp("%\\{"+c+"\\}","g"),b[c]));return a}function i(b){a.console&&a.console.warn&&a.console.warn("WARNING: "+b)}function j(a){var b={};for(var c in a)b[c]=a[c];return b}b.VERSION="0.4.2",b.prototype.locale=function(a){return a&&(this.currentLocale=a),this.currentLocale},b.prototype.extend=function(a,b){var c;for(var d in a)a.hasOwnProperty(d)&&(c=a[d],b&&(d=b+"."+d),"object"==typeof c?this.extend(c,d):this.phrases[d]=c)},b.prototype.clear=function(){this.phrases={}},b.prototype.replace=function(a){this.clear(),this.extend(a)},b.prototype.t=function(a,b){var c,d;return b=null==b?{}:b,"number"==typeof b&&(b={smart_count:b}),"string"==typeof this.phrases[a]?c=this.phrases[a]:"string"==typeof b._?c=b._:this.allowMissing?c=a:(this.warn('Missing translation for key: "'+a+'"'),d=a),"string"==typeof c&&(b=j(b),d=e(c,this.currentLocale,b.smart_count),d=h(d,b)),d};var k="||||",l={chinese:function(a){return 0},german:function(a){return 1!==a?1:0},french:function(a){return a>1?1:0},russian:function(a){return a%10===1&&a%100!==11?0:a%10>=2&&4>=a%10&&(10>a%100||a%100>=20)?1:2},czech:function(a){return 1===a?0:a>=2&&4>=a?1:2},polish:function(a){return 1===a?0:a%10>=2&&4>=a%10&&(10>a%100||a%100>=20)?1:2},icelandic:function(a){return a%10!==1||a%100===11?1:0}},m={chinese:["fa","id","ja","ko","lo","ms","th","tr","zh"],german:["da","de","en","es","fi","el","he","hu","it","nl","no","pt","sv"],french:["fr","tl","pt-br"],russian:["hr","ru"],czech:["cs"],polish:["pl"],icelandic:["is"]};"undefined"!=typeof module&&module.exports?module.exports=b:a.Polyglot=b}(this);var i18n=new Polyglot;i18n.locale(locale),i18n.extend({from:"From",to:"To",cmp:"Compare with"}),"es"==i18n.locale()&&i18n.extend({from:"Desde",to:"Hasta",cmp:"Comparar con"});var current_selected_value="",StockTools=function(a,b){"use strict";function c(){var c=d3.select(a).append("div").attr("class","c3-header"),f=c.append("div").attr("class","c3-periodos").append("ul").attr("class","c3-periodos"),g=c.append("div").attr("class","c3-intervalos-contenedor").append("ul").attr("class","c3-intervalos");g.append("li").text(i18n.t("from")),g.append("li").append("input").attr("type","text").style("text-align","center").attr("name","inicio").attr("id","inicio").attr("value",datos.columns[0][1]),g.append("li").text(i18n.t("to")),g.append("li").append("input").attr("type","text").style("text-align","center").attr("name","fin").attr("id","fin").attr("value",datos.columns[0][datos.columns[0].length-1]);var h=c.append("div").attr("class","c3-botones").append("ul").attr("class","c3-botones");h.append("li").attr("id","update").on("click",e.e_update_click).append("a").attr("href","#").text("Actualizar"),datos.columns.forEach(function(a,b){b>0&&d.push(datos.columns[b][0])}),d[0]=i18n.t("cmp");var i=h.append("select").attr("class","c3_cmp");i.selectAll("opciones").data(d).enter().append("option").attr("class","opciones").attr("data-id",function(a){return a}).attr("value",function(a){return a}).text(function(a){return a}),i.on("change",e.e_comparar_click),c.append("div").attr("class","c3-clear-header").style("clear","both"),f.selectAll("botones").data(b).enter().append("li").attr("class",function(a){return a.seleccionado?"button selected":"button"}).attr("data-value",function(a){return a.cantidad}).attr("data-tipo",function(a){return a.tipo}).on("click",e.e_click_periodo).append("a").attr("href","#").attr("class",function(a){return a.seleccionado?"activo":""}).text(function(a){return a.texto}),e.m_establecer_fecha_inicial()}var d=[],e=this;e.m_establecer_fecha_inicial=function(){var a=d3.select(".c3-periodos .selected");if(null!=a[0][0]){var b=a.attr("data-tipo"),c=a.attr("data-value"),d=e.m_getFechaInicio(b,c);document.getElementById("inicio").value=formatDate(d)}},e.e_click_periodo=function(){var a=d3.select(this).select("a.activo");if(null==a[0][0]){var b=d3.select(this).attr("data-value"),c=d3.select(this).attr("data-tipo"),d=datos.columns[0].length-1,f=parseDate(datos.columns[0][d]),g=e.m_getFechaInicio(c,b);if(!m_intervalo_Correcto(g,f))throw new Error("No hay datos para este intervalo");if(document.getElementById("inicio").value=formatDate(g),document.getElementById("fin").value=formatDate(f),d3.select(".c3-periodos a.activo").classed("activo",!1),d3.select(this).select("a").classed("activo",!0),comparando){var h=[],i=e.m_calcular_comparacion(datos.columns[1][0],1,formatDate(g),formatDate(f)),j=document.getElementsByClassName("c3_cmp")[0].selectedIndex,k=e.m_calcular_comparacion(current_selected_value,j+1,formatDate(g),formatDate(f));h.push(i),h.push(k);var l=[g,f];chart.zoom(l),chart2.zoom(l),chart3.internal.brush.extent(l).update(),chart.load({columns:h})}else m_updateGrafica(g,f)}},e.m_getFechaInicio=function(a,b){var c=datos.columns[0].length-1,d=parseDate(datos.columns[0][c]),e=new Date(d.getTime());switch(a){case"dia":e.setDate(d.getDate()-b);break;case"mes":e.setMonth(d.getMonth()-b);break;case"anno":e.setYear(d.getFullYear()-b);break;case"hasta_la_fecha":var f=((new Date).getFullYear(),new Date(d.getFullYear(),0,1)),g=bisect(datos.columns[0],f);e=parseDate(datos.columns[0][g])}return e},e.e_update_click=function(){var a=parseDate(document.getElementById("inicio").value),b=parseDate(document.getElementById("fin").value);if(!m_intervalo_Correcto(a,b))throw new Error("No hay datos para este intervalo");if(d3.select(".c3-periodos a.activo").classed("activo",!1),comparando){var c=[],d=e.m_calcular_comparacion(datos.columns[1][0],1,formatDate(a),formatDate(b)),f=document.getElementsByClassName("c3_cmp")[0].selectedIndex,g=e.m_calcular_comparacion(current_selected_value,f+1,formatDate(a),formatDate(b));c.push(d),c.push(g);var h=[a,b];chart.zoom(h),chart2.zoom(h),chart3.internal.brush.extent(h).update(),chart.load({columns:c})}else m_updateGrafica(a,b)},e.m_buscarFecha=function(a){return datos.columns[0].indexOf(a)},e.m_calcular_comparacion=function(a,b,c,d){var f=[a],g=e.m_buscarFecha(c),h=e.m_buscarFecha(d),i=+datos.columns[b][g];return datos.columns[b].forEach(function(a,b){if(b>0)if(b>=g&&h>=b){var c=+a,d=c/i-1;d=+d.toFixed(2),f.push(d)}else f.push(null)}),f},e.m_restaurar_grafica=function(){comparando?chart.load({columns:[datos.columns[1]],unload:[current_selected_value]}):alert("no estas comparando")},e.e_comparar_click=function(){var a="";""!=current_selected_value&&(a=current_selected_value);var b=this.options[this.selectedIndex].value,c=parseDate(document.getElementById("inicio").value),d=parseDate(document.getElementById("fin").value),f=[];if(!m_intervalo_Correcto(c,d))throw new Error("Intervalo incorrecto");if(0!=this.selectedIndex){comparando=!0,current_selected_value=b;var g=e.m_calcular_comparacion(datos.columns[1][0],1,formatDate(c),formatDate(d)),h=e.m_calcular_comparacion(b,this.selectedIndex+1,formatDate(c),formatDate(d));f.push(g),f.push(h),chart.load(""!=a?{columns:f,unload:[a]}:{columns:f})}else e.m_restaurar_grafica(c,d),current_selected_value="",comparando=!1},c()};